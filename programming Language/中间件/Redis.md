# 使用场景
## Redis作为Cache
### 背景
首先引出缓存这个概念：
使用缓存的目的是为了加速，比如说对于一些不经常变得数据，在service方法中进行一次数据库查询之后，应该把结果放入缓存中。而不是每次进入service方法都需要进行数据库查询。从而达到加速的目的
在单系统中，最简单的缓存实现就是`HashMap`，我们可以直接把数据库查询的结果作为Value放入HashMap
但是这种实现在分布式场景下，就会有问题：
问题一：可能会进行多次数据库查询，效率不高
<img src="./redis cache.png">

如上图，如果请求被负载均衡到第一台主机，因为是第一次访问，所以需要进行数据库查询，查询之后将其结果放入缓存中
如果第二次请求被负载均衡到第二台主机，同样需要进行数据库查询

问题二：某些场景下会出错
如果某个请求被负载均衡到第一台主机，并且该请求进行了一些更新操作，那么系统会执行更新操作，并把结果放入缓存
如果同样的请求被负载均衡到第二台主机，恰巧该主机中的缓存有值（但是旧值Old Value），系统直接返回旧值
从用户的视角下，系统就出错了：明明我已经更新了某条数据，为什么刷新后数据没有变？
即系统就会很诡异，有时候刷新得到的是正确的值，但有时候刷新得到的是错误的
* 解决方案：Redis作为中间件缓存
<img src="./redis cache2.png">